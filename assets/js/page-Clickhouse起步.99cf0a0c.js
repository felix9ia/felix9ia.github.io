(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{517:function(e,s,a){"use strict";a.r(s);var n=a(1),t=Object(n.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"clickhouse-起步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clickhouse-起步"}},[e._v("#")]),e._v(" Clickhouse 起步")]),e._v(" "),a("h2",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[e._v("#")])]),e._v(" "),a("h3",{attrs:{id:"配置启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置启动"}},[e._v("#")]),e._v(" 配置启动")]),e._v(" "),a("p",[e._v("编辑 "),a("code",[e._v("/etc/clickhouse-server/config.xml")]),e._v(",取消下面的注释")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<listen_host>::</listen_host>\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("然后重启")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("\nservice clickhouse-server restart \n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("h3",{attrs:{id:"docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[e._v("#")]),e._v(" Docker")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("docker run -it --rm -p 8123:8123 --name clickhouse-server-house-ops yandex/clickhouse-server\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("h1",{attrs:{id:"连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接"}},[e._v("#")]),e._v(" 连接")]),e._v(" "),a("p",[e._v("TCP："),a("code",[e._v("9000")])]),e._v(" "),a("p",[e._v("HTTP： "),a("code",[e._v("8123")])]),e._v(" "),a("h2",{attrs:{id:"创建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建"}},[e._v("#")]),e._v(" 创建")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("create database if not exists neu_metric; \n# or\ncreate database if not exists neu_metric ON CLUSTER default; \n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("h3",{attrs:{id:"kafka"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kafka"}},[e._v("#")]),e._v(" Kafka")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://clickhouse.tech/docs/en/interfaces/formats/",target:"_blank",rel:"noopener noreferrer"}},[e._v("输入和输出数据的格式"),a("OutboundLink")],1)]),e._v(" "),a("ol",[a("li",[a("p",[e._v("创建 kafka 同步消费表")]),e._v(" "),a("p",[e._v("此步骤用于接收")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("CREATE TABLE neu_metric.kafka_quality_metric\n(\n  id Int32,\n  reportAt DateTime64(3, 'Asia/Shanghai'),\n  reportAtOfMin DateTime64(3, 'Asia/Shanghai'),\n  createdAt DateTime64(3, 'Asia/Shanghai'),\n  idxCode String,\n  idxAvgValue Float64,\n  provider String,\n  aggGranularity String,\n  appid String,\n  uid String,\n  platform String,\n  sdkVersion String,\n  sessionId String,\n  sessionEndTime DateTime64(3, 'Asia/Shanghai'),\n  sessionStartTime DateTime64(3, 'Asia/Shanghai'),\n  phoneName String,\n  phoneVersion String,\n  appVersion String,\n  audioCoding String,\n  countrycode String,\n  network String,\n  videoCoding String,\n  screenSize String,\n  denoiseLevel Int32,\n  os String,\n  gpu1 String,\n  reportAtByClient DateTime64(3, 'Asia/Shanghai'),\n  codeOfSessionAndUid String,\n  codeOfSessionAndPeerUid String\n) ENGINE = Kafka()\nSETTINGS\n    kafka_broker_list = '10.18.101.5:9092',\n    kafka_topic_list = 'topic-metric-index',\n    kafka_group_name = 'click_house_group',\n    kafka_format = 'JSONEachRow',\n    kafka_row_delimiter = '\\n',\n    input_format_import_nested_json = 1\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br"),a("span",{staticClass:"line-number"},[e._v("31")]),a("br"),a("span",{staticClass:"line-number"},[e._v("32")]),a("br"),a("span",{staticClass:"line-number"},[e._v("33")]),a("br"),a("span",{staticClass:"line-number"},[e._v("34")]),a("br"),a("span",{staticClass:"line-number"},[e._v("35")]),a("br"),a("span",{staticClass:"line-number"},[e._v("36")]),a("br"),a("span",{staticClass:"line-number"},[e._v("37")]),a("br"),a("span",{staticClass:"line-number"},[e._v("38")]),a("br"),a("span",{staticClass:"line-number"},[e._v("39")]),a("br"),a("span",{staticClass:"line-number"},[e._v("40")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("创建目标表 MergeTree")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("create table neu_metric.quality_metric (\n  id Int32,\n  reportAt DateTime64(3, 'Asia/Shanghai'),\n  reportAtOfMin DateTime64(3, 'Asia/Shanghai'),\n  createdAt DateTime64(3, 'Asia/Shanghai'),\n  idxCode String,\n  idxAvgValue Float64,\n  provider String,\n  aggGranularity String,\n  appid String,\n  uid String,\n  platform String,\n  sdkVersion String,\n  sessionId String,\n  sessionEndTime DateTime64(3, 'Asia/Shanghai'),\n  sessionStartTime DateTime64(3, 'Asia/Shanghai'),\n  phoneName String,\n  phoneVersion String,\n  appVersion String,\n  audioCoding String,\n  countrycode String,\n  network String,\n  videoCoding String,\n  screenSize String,\n  denoiseLevel Int32,\n  os String,\n  gpu1 String,\n  reportAtByClient DateTime64(3, 'Asia/Shanghai'),\n  codeOfSessionAndUid String,\n  codeOfSessionAndPeerUid String\n) ENGINE = MergeTree()\n    ORDER BY (id)\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br"),a("span",{staticClass:"line-number"},[e._v("31")]),a("br"),a("span",{staticClass:"line-number"},[e._v("32")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("创建前两者的物化桥梁")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("CREATE MATERIALIZED VIEW neu_metric.consumer  TO neu_metric.quality_metric AS SELECT * FROM neu_metric.kafka_quality_metric\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("Kafka 生产并查询数据")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("select *\nfrom quality_metric\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("停止解析")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("DETACH TABLE  neu_metric.consumer\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("开启解析")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ATTACH TABLE neu_metric.consumer\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])]),e._v(" "),a("li",[a("p",[e._v("删除表")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("DROP TABLE neu_metric.kafka_quality_metric\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])])])]),e._v(" "),a("p",[e._v("删除脏数据步骤：")]),e._v(" "),a("p",[e._v("1、执行"),a("code",[e._v("DETACH TABLE sync_kafka_u0")]),e._v(", 下线kafka引擎表。")]),e._v(" "),a("p",[e._v("2、重置Kafka对应的Offset")]),e._v(" "),a("p",[e._v("kafka-consumer-groups --bootstrap-server 172.30.xxx.xxx:9092 \\")]),e._v(" "),a("p",[e._v("--topic ck.t0 --group t0.g1 \\")]),e._v(" "),a("p",[e._v("--reset-offsets --to-earliest --execute")]),e._v(" "),a("p",[e._v("也可通过kafka-consumer-groups.sh命令查看具体的offset，然后通过重置功能重置到具体的offset（具体指定忽略多少条记录）。")]),e._v(" "),a("p",[e._v("3、执行"),a("code",[e._v("ATTACH TABLE data_source")]),e._v(", 上线该表。")]),e._v(" "),a("p",[e._v("作者：淡淡的小番茄\n链接：https://www.jianshu.com/p/745531f7650e\n来源：简书\n著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。")]),e._v(" "),a("h2",{attrs:{id:"分区和ttl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分区和ttl"}},[e._v("#")]),e._v(" 分区和TTL")]),e._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),a("p",[e._v("以下是上面流程的参考引用。")]),e._v(" "),a("h3",{attrs:{id:"工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工具"}},[e._v("#")]),e._v(" 工具")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://tooltt.com/json2clickhouse/",target:"_blank",rel:"noopener noreferrer"}},[e._v("在线JSON转ClickHouse数据表工具"),a("OutboundLink")],1)]),e._v(" "),a("h3",{attrs:{id:"官网"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#官网"}},[e._v("#")]),e._v(" 官网")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://clickhouse.com/docs/zh/sql-reference/data-types/",target:"_blank",rel:"noopener noreferrer"}},[e._v("数据类型"),a("OutboundLink")],1)]),e._v(" "),a("p",[a("a",{attrs:{href:"https://clickhouse.tech/docs/en/interfaces/formats/",target:"_blank",rel:"noopener noreferrer"}},[e._v("输入和输出数据的格式"),a("OutboundLink")],1)]),e._v(" "),a("h3",{attrs:{id:"阿里云文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#阿里云文档"}},[e._v("#")]),e._v(" 阿里云文档")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://help.aliyun.com/document_detail/212277.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("从Spark导入数据至ClickHouse"),a("OutboundLink")],1)]),e._v(" "),a("p",[a("a",{attrs:{href:"https://help.aliyun.com/document_detail/146007.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("从Kafka同步"),a("OutboundLink")],1)]),e._v(" "),a("p",[a("a",{attrs:{href:"https://help.aliyun.com/document_detail/299949.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("从Kafka导入数据至ClickHouse"),a("OutboundLink")],1)]),e._v(" "),a("h3",{attrs:{id:"腾讯云"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#腾讯云"}},[e._v("#")]),e._v(" 腾讯云")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://cloud.tencent.com/document/product/1299/49847",target:"_blank",rel:"noopener noreferrer"}},[e._v("腾讯云-ClickHouse SQL 语法参考"),a("OutboundLink")],1)]),e._v(" "),a("h3",{attrs:{id:"其他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[e._v("#")]),e._v(" 其他")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://cpp.la/603.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClickHouse-Kafka引擎，kafka to clickhouse详细教程"),a("OutboundLink")],1)]),e._v(" "),a("p",[a("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1762843",target:"_blank",rel:"noopener noreferrer"}},[e._v("ClickHouse实战-ClickHouse整合Kafka"),a("OutboundLink")],1)]),e._v(" "),a("p",[a("a",{attrs:{href:"https://sineyuan.github.io/post/clickhouse-docker-quick-start/",target:"_blank",rel:"noopener noreferrer"}},[e._v("用Docker快速上手Clickhouse"),a("OutboundLink")],1)]),e._v(" "),a("p",[a("a",{attrs:{href:"https://clickvisual.gocn.vip/clickvisual/03funcintro/clickHouse-commonly-used-sql.html#%E4%BB%8A%E6%97%A5-pv",target:"_blank",rel:"noopener noreferrer"}},[e._v("clickvisual - ClickHouse 常用 SQL"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=t.exports}}]);