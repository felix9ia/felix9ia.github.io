(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{569:function(t,e,a){"use strict";a.r(e);var r=a(1),n=Object(r.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:""}},[a("a",{staticClass:"header-anchor",attrs:{href:"#"}},[t._v("#")])]),t._v(" "),a("h1",{attrs:{id:"ci-cd实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ci-cd实践"}},[t._v("#")]),t._v(" CI/CD实践")]),t._v(" "),a("p",[t._v("这里是 "),a("RouterLink",{attrs:{to:"/computer/op/构建应用流程.html"}},[t._v("构建应用流程")]),t._v(" 环节当中的一部分，示例代码放在了 "),a("a",{attrs:{href:"https://gitlab.com/felix9ia/ci_demo",target:"_blank",rel:"noopener noreferrer"}},[t._v("ci_demo"),a("OutboundLink")],1),t._v(" 当中")],1),t._v(" "),a("p",[a("a",{attrs:{href:"https://meigit.readthedocs.io/en/latest/gitlab_ci_.gitlab-ci.yml_detail.html#artifacts-paths",target:"_blank",rel:"noopener noreferrer"}},[a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"ci-cd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ci-cd"}},[t._v("#")]),t._v(" CI/CD")]),t._v(" "),a("p",[t._v("这里的 CI/CD 是总称，代表了持续集成、持续交付和持续部署。可以参考"),a("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/introduction/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Introduction to CI/CD with GitLab"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("img",{attrs:{src:"https://miro.medium.com/max/1400/0*SY75sciWGOk7ruik.png",alt:"https://sean22492249.medium.com/gitlab-ci-cd-%E4%BB%8B%E7%B4%B9%E8%88%87-runner-%E7%9A%84%E6%9E%B6%E8%A8%AD-afdbde9f22aa"}})]),t._v(" "),a("h3",{attrs:{id:"持续集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#持续集成"}},[t._v("#")]),t._v(" 持续集成")]),t._v(" "),a("p",[t._v("持续集成（continuous Integration），简称 CI，是一种软件开始实践，是指每个成员在一天当中会不断的集成到主干分支，并且在提交、合并代码时对项目进行构建、编译和测试，每次集成都通过自动化的构建。测试不通过，不能进行集成。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://qcdn.xueyuanjun.com/wp-content/uploads/2019/04/069e09bfc30ba6ef9b890975676b0d69.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"持续交付"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#持续交付"}},[t._v("#")]),t._v(" 持续交付")]),t._v(" "),a("p",[t._v("持续交付（Continuous Delivery）将集成到主干的软件新版本，手动部署到准生产环境（测试环境）")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://qcdn.xueyuanjun.com/wp-content/uploads/2019/04/ec92ab317c3e22a2fe180de4d01df48a.jpg",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"持续部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#持续部署"}},[t._v("#")]),t._v(" 持续部署")]),t._v(" "),a("p",[t._v("持续部署（Continuous Deployment）在持续交付的基础上，部署到生产环境的过程自动化。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://qcdn.xueyuanjun.com/wp-content/uploads/2019/04/0fdf7af30fedd9ef473d3f148757a7d3.jpg",alt:"https://laravelacademy.org/post/19615"}})]),t._v(" "),a("h2",{attrs:{id:"方案对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#方案对比"}},[t._v("#")]),t._v(" 方案对比")]),t._v(" "),a("p",[t._v("主要在以下方案中进行选择，自己想的原则是：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("不冗余服务")]),t._v(" "),a("p",[t._v("能用一个服务搞定的，就不用多个服务。")])]),t._v(" "),a("li",[a("p",[t._v("坑大小")]),t._v(" "),a("p",[t._v("此方案是否足够完善，有足够的文档生态支持踩坑。")])])]),t._v(" "),a("h3",{attrs:{id:"gitlab-ci"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci"}},[t._v("#")]),t._v(" Gitlab CI")]),t._v(" "),a("p",[t._v("在"),a("code",[t._v("Gitlab 8.0")]),t._v("之后就默认集成，并且自动开启。")]),t._v(" "),a("h3",{attrs:{id:"jenkins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jenkins"}},[t._v("#")]),t._v(" Jenkins")]),t._v(" "),a("p",[t._v("市面上比较成熟的方案，可以完整的实现 CI 和 CD")]),t._v(" "),a("h3",{attrs:{id:"其他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[t._v("#")]),t._v(" 其他")]),t._v(" "),a("ul",[a("li",[t._v("Travis CI")]),t._v(" "),a("li",[t._v("CircleCI")])]),t._v(" "),a("h3",{attrs:{id:"结论"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结论"}},[t._v("#")]),t._v(" 结论")]),t._v(" "),a("p",[t._v("选择 Gitlab 做  CI 部分， Jenkins 做 deploy 的部分, 可以参考 "),a("a",{attrs:{href:"https://www.cnblogs.com/wilburxu/p/11051948.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("基于GitLab CI搭建Golang自动构建环境"),a("OutboundLink")],1),t._v("，而中间的桥梁可以 "),a("code",[t._v("git tag")]),t._v(" 成为 "),a("code",[t._v("Release")]),t._v(" 来实现。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img2020.cnblogs.com/blog/1062001/202004/1062001-20200420104303539-1990871526.png",alt:"https://www.cnblogs.com/wilburxu/p/11051948.html"}})]),t._v(" "),a("h2",{attrs:{id:"gitlab-ci-搭建环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-ci-搭建环境"}},[t._v("#")]),t._v(" Gitlab-CI 搭建环境")]),t._v(" "),a("p",[t._v("主要参考了"),a("a",{attrs:{href:"https://www.jianshu.com/p/8655f1ef26ee",target:"_blank",rel:"noopener noreferrer"}},[t._v("Golang基于Gitlab CI/CD部署方案"),a("OutboundLink")],1),t._v(" 以及 "),a("a",{attrs:{href:"https://www.cnblogs.com/wilburxu/p/11051948.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("基于GitLab CI搭建Golang自动构建环境"),a("OutboundLink")],1),t._v("一文。")]),t._v(" "),a("p",[t._v("集成的流程包括以下：")]),t._v(" "),a("ul",[a("li",[t._v("lint 校验")]),t._v(" "),a("li",[t._v("单元测试")]),t._v(" "),a("li",[t._v("构建")])]),t._v(" "),a("h3",{attrs:{id:"基础概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础概念"}},[t._v("#")]),t._v(" 基础概念")]),t._v(" "),a("p",[a("a",{attrs:{href:""}},[t._v("Markfile")]),t._v(" 是Linux 的构建工具，具体教程可以参考 "),a("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2015/02/make.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("阮一峰：Make 命令教程"),a("OutboundLink")],1),t._v("当中所说的。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000006120164",target:"_blank",rel:"noopener noreferrer"}},[t._v("用 GitLab CI 进行持续集成"),a("OutboundLink")],1),t._v(" 文章中，对一些概念的梳理：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("+------------------+           +----------------+\n|                  |  trigger  |                |\n|   Commit / MR    +----------\x3e+    Pipeline    |\n|                  |           |                |\n+------------------+           +----------------+\n\n+--------------------------------------------------------+\n|                                                        |\n|  Pipeline                                              |\n|                                                        |\n|  +-----------+     +------------+      +------------+  |\n|  |  Stage 1  |----\x3e|   Stage 2  |-----\x3e|   Stage 3  |  |\n|  +-----------+     +------------+      +------------+  |\n|                                                        |\n+--------------------------------------------------------+\n\n+------------------------------------------+\n|                                          |\n|  Stage 1                                 |\n|                                          |\n|  +---------+  +---------+  +---------+   |\n|  |  Job 1  |  |  Job 2  |  |  Job 3  |   |\n|  +---------+  +---------+  +---------+   |\n|                                          |\n+------------------------------------------+\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br")])]),a("p",[t._v("里面有很多变量："),a("a",{attrs:{href:"http://www.ttlsa.com/auto/gitlab-cicd-variables-zh-document/",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitLab CI/CD Variables 中文文档"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"安装和运行-gitlab-runner"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装和运行-gitlab-runner"}},[t._v("#")]),t._v(" 安装和运行 Gitlab Runner")]),t._v(" "),a("p",[t._v("具体的常用命令可以参考： "),a("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1624837",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitLab Runner安装注册配置管理"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("运行命令时全部使用 "),a("code",[t._v("sudo")]),t._v(" 前缀")]),t._v(" "),a("p",[t._v("使用 docker 安装 runner，"),a("a",{attrs:{href:"https://docs.gitlab.com/runner/install/docker.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("install runner by docker"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("自己梳理的流程是：")]),t._v(" "),a("p",[t._v("register(注册) -> run（启动） -> install（服务管理）")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("以普通用户身份注册的 Gitlab 服务不会在后台运行，此时需要手动执行 gitlab-runner run 命令\n\n如果是超级用户用 sudo gitlab-runner register 注册的服务，会在后台运行，不需要执行上述命令。\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/2b43151fb92e",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitLab-CI与GitLab-Runner"),a("OutboundLink")],1),t._v(" 里描述了两者之间的关系")]),t._v(" "),a("p",[t._v("https://docs.gitlab.com/runner/install/linux-manually.html")]),t._v(" "),a("p",[t._v('# Replace ${arch} with any of the supported architectures, e.g. amd64, arm, arm64 # A full list of architectures can be found here https://gitlab-runner-downloads.s3.amazonaws.com/latest/index.html curl -LJO "https://gitlab-runner-downloads.s3.amazonaws.com/latest/deb/gitlab-runner_arm64.deb"')]),t._v(" "),a("h4",{attrs:{id:"拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拉取镜像"}},[t._v("#")]),t._v(" 拉取镜像")]),t._v(" "),a("p",[t._v("这里需要注意平台的问题，是 amd64 还是 arm64")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/yobasystems/gitlab-runner",target:"_blank",rel:"noopener noreferrer"}},[t._v("yobasystems-gitlab-runner"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/ulm0/gitlab-runner",target:"_blank",rel:"noopener noreferrer"}},[t._v("ulm0-gitlab-runner"),a("OutboundLink")],1)]),t._v(" "),a("h4",{attrs:{id:"启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[t._v("#")]),t._v(" 启动")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker run -d --name arm-runner \\\n-v $(pwd)/.runner:/etc/gitlab-runner -v /server:/server \\\n--restart=always \\\nklud/gitlab-runner\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h4",{attrs:{id:"注册"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册"}},[t._v("#")]),t._v(" 注册")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker exec -it arm-runner /bin/sh\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("docker exec -it arm-runner gitlab-runner register\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"其他操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他操作"}},[t._v("#")]),t._v(" 其他操作")]),t._v(" "),a("p",[t._v("可以细节参考："),a("a",{attrs:{href:"https://segmentfault.com/a/1190000023117085",target:"_blank",rel:"noopener noreferrer"}},[t._v("搭建一个使用 GitLab CI 的项目"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# 停止服务\nsudo gitlab-runner stop\n# 卸载服务\nsudo gitlab-runner uninstall\n# 重新安装服务，指定工作目录和用户\nsudo gitlab-runner install --working-directory /home/gitlab-runner --user root\n# 完整配置\n# sudo gitlab-runner install --working-directory /home/gitlab-runner --config /etc/gitlab-runner/config.toml --service gitlab-runner --syslog --user gitlab-runner\n# 注册\n sudo gitlab-runner register\n# 校验\nsudo gitlab-runner verify\n# 启动服务\nsudo gitlab-runner start\n# 查看状态\nsudo gitlab-runner status\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br")])]),a("p",[t._v("WARN: 如何遇到没有权限调用 install 时，请调用")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("kill -TERM 1\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"构建问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建问题"}},[t._v("#")]),t._v(" 构建问题")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://stackoverflow.com/questions/61105333/cannot-connect-to-the-docker-daemon-at-tcp-localhost2375-is-the-docker-daem",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cannot connect to the Docker daemon at tcp://localhost:2375. Is the docker daemon running?"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://devops.stackexchange.com/questions/9359/gitlab-ci-error-during-connect-get-http-docker2375-v1-40-containers-jsonall",target:"_blank",rel:"noopener noreferrer"}},[t._v("dial tcp: lookup thedockerhost on 183.60.82.98:53: no such hos"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("如果说没有权限之类的，就添加下面的：")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("privileged = true\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"安装相关相关依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装相关相关依赖"}},[t._v("#")]),t._v(" 安装相关相关依赖")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Go")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/b2222fc04f47",target:"_blank",rel:"noopener noreferrer"}},[t._v("Centos Linux 使用Yum安装Go和配置环境"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yum install golang\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("golint")])]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('# 换镜像\n# 启用 Go Modules 功能\n$env:GO111MODULE="on"\n\n# 配置 GOPROXY 环境变量，以下三选一\n\n# 1. 七牛 CDN\n$env:GOPROXY="https://goproxy.cn,direct"\n\n# 2. 阿里云\n$env:GOPROXY="https://mirrors.aliyun.com/goproxy/,direct"\n\n# 3. 官方\n$env:GOPROXY="https://goproxy.io,direct"\n\n# 安装 golint\ngo get -u golang.org/x/lint/golint\n')])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])])])]),t._v(" "),a("h2",{attrs:{id:"构建-pipeline"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建-pipeline"}},[t._v("#")]),t._v(" 构建 pipeline")]),t._v(" "),a("h3",{attrs:{id:"lint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lint"}},[t._v("#")]),t._v(" lint")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("golint")]),t._v("，对整个项目进行扫描")]),t._v(" "),a("h3",{attrs:{id:"unit-test"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unit-test"}},[t._v("#")]),t._v(" unit_test")]),t._v(" "),a("p",[t._v("使用 "),a("code",[t._v("go test")])]),t._v(" "),a("h3",{attrs:{id:"coverage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#coverage"}},[t._v("#")]),t._v(" coverage")]),t._v(" "),a("p",[t._v("测试覆盖率")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://ronniegane.kiwi/blog/2019/06/18/go-gitlab/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gitlab CI for Go projects"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://penkovski.com/post/gitlab-golang-test-coverage/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Golang Multi Package Test Coverage in Gitlab"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"徽章"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#徽章"}},[t._v("#")]),t._v(" 徽章")]),t._v(" "),a("p",[t._v("最后的配置解析")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("^coverage:\\s(\\d+(?:\\.\\d+)?%)\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h3",{attrs:{id:"结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结果"}},[t._v("#")]),t._v(" 结果")]),t._v(" "),a("p",[t._v("最后形成的的结果是：")]),t._v(" "),a("h3",{attrs:{id:"build"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#build"}},[t._v("#")]),t._v(" build")]),t._v(" "),a("p",[t._v("以及 Bilibili 之前泄露过的"),a("a",{attrs:{href:"https://gitee.com/felix9ia/open-bilibili-go-common.git",target:"_blank",rel:"noopener noreferrer"}},[t._v("open-bilibili-go-common"),a("OutboundLink")],1),t._v(",整体思路是采用 "),a("code",[t._v("Merge Request")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Pull request vs Merge request](https://stackoverflow.com/questions/22199432/pull-request-vs-merge-request)\n\n[阮一峰：Merge Request 的命令行管理](http://www.ruanyifeng.com/blog/2017/07/pull_request.html)\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("而各自的 "),a("code",[t._v("fork")]),t._v(" 仓库则使用 "),a("code",[t._v("tag")]),t._v(" 和类似 "),a("code",[t._v("Jenkins")]),t._v("的构建工具通过 "),a("code",[t._v("tag")]),t._v("的版本管理进行打包部署。")]),t._v(" "),a("p",[t._v("构建主要参考了 "),a("RouterLink",{attrs:{to:"/computer/op/go_mutil_module.html"}},[t._v("Go 多模块构建方案")]),t._v(" 对项目进行。")],1),t._v(" "),a("p",[t._v("部署可以参考 "),a("a",{attrs:{href:"https://blog.csdn.net/weixin_43840640/article/details/100597073",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jenkins基于gitlab中的Tag进行构建"),a("OutboundLink")],1),t._v(" ，以及 "),a("a",{attrs:{href:"https://blog.51cto.com/11064706/2511340",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用Jenkins Git参数实现分支标签动态选择"),a("OutboundLink")],1),t._v(" 来进行构建。")]),t._v(" "),a("h2",{attrs:{id:"其他尝试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他尝试"}},[t._v("#")]),t._v(" 其他尝试")]),t._v(" "),a("p",[t._v("如何在pre-commit 运行 lint？")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://razeencheng.com/post/golang-and-git-commit-message-pre-commit",target:"_blank",rel:"noopener noreferrer"}},[t._v("利用git hook规范你的代码与commit message"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/TekWizely/pre-commit-golang",target:"_blank",rel:"noopener noreferrer"}},[t._v("pre-commit-golang"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://tech.youzan.com/you-zan-go-xiang-mu-dan-ce-ji-cheng-zeng-liang-fu-gai-lu-tong-ji-yu-fen-xi/",target:"_blank",rel:"noopener noreferrer"}},[t._v("有赞 GO 项目单测、集成、增量覆盖率统计与分析"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000011890710",target:"_blank",rel:"noopener noreferrer"}},[t._v("gitlab-ci配置详解(二)"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://laravelacademy.org/post/19615",target:"_blank",rel:"noopener noreferrer"}},[t._v("持续集成的定义和常用 CI 系统对比"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://sean22492249.medium.com/gitlab-ci-cd-%E4%BB%8B%E7%B4%B9%E8%88%87-runner-%E7%9A%84%E6%9E%B6%E8%A8%AD-afdbde9f22aa",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gitlab CI/CD 介紹與 Runner 的架設"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://gist.github.com/kolotaev/9d9f7e1e0cfbdaf88dd91d615613a977#file-golang-pre-commit",target:"_blank",rel:"noopener noreferrer"}},[t._v("golang-pre-commit"),a("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=n.exports}}]);