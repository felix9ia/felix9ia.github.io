(window.webpackJsonp=window.webpackJsonp||[]).push([[140],{542:function(e,t,r){"use strict";r.r(t);var a=r(1),s=Object(a.a)({},(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[r("h1",{attrs:{id:"接入-stripe"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#接入-stripe"}},[e._v("#")]),e._v(" 接入 stripe")]),e._v(" "),r("p",[e._v("https://neuvision.yeecall.com:1443/superpay/callback/stripe")]),e._v(" "),r("h2",{attrs:{id:"各个客户端"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#各个客户端"}},[e._v("#")]),e._v(" 各个客户端")]),e._v(" "),r("p",[e._v("web")]),e._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://stripe.com/docs/api/checkout/sessions",target:"_blank",rel:"noopener noreferrer"}},[e._v("Checkout Session"),r("OutboundLink")],1),e._v(" 为了指定 stripe 确认订单的信息")])]),e._v(" "),r("p",[e._v("![image-20220704120058894](/Users/lfcp/Library/Application Support/typora-user-images/image-20220704120058894.png)")]),e._v(" "),r("p",[e._v("ios")]),e._v(" "),r("ul",[r("li",[e._v("点击 Apple Pay 创建 PKPaymentRequest 付款请求，会弹出 Pay 的弹窗，显示公司名称和支付的金额。")]),e._v(" "),r("li",[e._v("PaymentMethod 指定扣款的卡 https://stripe.com/docs/api/payment_methods/create")]),e._v(" "),r("li",[e._v("呈现 Apple Pay 表单")]),e._v(" "),r("li",[e._v("服务端创建 PaymentIntent")])]),e._v(" "),r("p",[e._v("旧")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://stripe.com/docs/payments/accept-a-payment-synchronously?platform=web",target:"_blank",rel:"noopener noreferrer"}},[e._v("在服务器上确认银行卡付款旧版"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24ely1h3vcrisl80j21pc0tcwht.jpg",alt:""}})]),e._v(" "),r("p",[e._v("新，需要打招呼使用")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://stripe.com/docs/payments/finalize-payments-on-the-server",target:"_blank",rel:"noopener noreferrer"}},[e._v("Finalize payments on the server 新版"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24ely1h3vcrtngocj21b50u076d.jpg",alt:""}})]),e._v(" "),r("h2",{attrs:{id:"回调"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#回调"}},[e._v("#")]),e._v(" 回调")]),e._v(" "),r("p",[e._v("https://stripe.com/docs/payments/handling-payment-events 在 "),r("a",{attrs:{href:"https://dashboard.stripe.com/webhooks",target:"_blank",rel:"noopener noreferrer"}},[e._v("webhooks"),r("OutboundLink")],1),e._v(" 中添加回调地址，")]),e._v(" "),r("p",[e._v("重试机制 "),r("a",{attrs:{href:"https://stripe.com/docs/webhooks/best-practices#events-and-retries",target:"_blank",rel:"noopener noreferrer"}},[e._v("提交尝试和重试"),r("OutboundLink")],1)]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("stripe listen --forward-to http://localhost:58081/superpay/callback/stripe\n\nstripe listen --forward-to http://localhost:58081/superpay/callback/stripe --log-level debug\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br"),r("span",{staticClass:"line-number"},[e._v("2")]),r("br"),r("span",{staticClass:"line-number"},[e._v("3")]),r("br")])]),r("h3",{attrs:{id:"payment-状态"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#payment-状态"}},[e._v("#")]),e._v(" Payment 状态")]),e._v(" "),r("p",[e._v("可以通过 "),r("a",{attrs:{href:"https://stripe.com/docs/api/events/types#event_types-payment_intent.succeeded",target:"_blank",rel:"noopener noreferrer"}},[e._v("event_types-payment_intent "),r("OutboundLink")],1),e._v("查看")]),e._v(" "),r("h2",{attrs:{id:"测试"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[e._v("#")]),e._v(" 测试")]),e._v(" "),r("p",[e._v("查看该文档 "),r("a",{attrs:{href:"https://stripe.com/docs/payments/handling-payment-events",target:"_blank",rel:"noopener noreferrer"}},[e._v("处理 webhook 事件"),r("OutboundLink")],1),e._v(" 以获得支持,涉及到 CLI 则"),r("a",{attrs:{href:"https://stripe.com/docs/webhooks/test",target:"_blank",rel:"noopener noreferrer"}},[e._v("cli-webhook"),r("OutboundLink")],1)]),e._v(" "),r("p",[e._v("在此页面查看 "),r("a",{attrs:{href:"https://stripe.com/docs/testing#use-test-cards",target:"_blank",rel:"noopener noreferrer"}},[e._v("测试"),r("OutboundLink")],1),e._v(" 相关流程")]),e._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[e._v("stripe trigger payment_intent.succeeded\n")])]),e._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[e._v("1")]),r("br")])]),r("h2",{attrs:{id:"退款和取消付款"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#退款和取消付款"}},[e._v("#")]),e._v(" 退款和取消付款")]),e._v(" "),r("p",[e._v("请参考"),r("a",{attrs:{href:"https://stripe.com/docs/refunds?locale=zh-CN",target:"_blank",rel:"noopener noreferrer"}},[e._v("退款和取消付款"),r("OutboundLink")],1)]),e._v(" "),r("h2",{attrs:{id:"参考"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),r("p",[r("a",{attrs:{href:"https://stripe.com/docs/keys",target:"_blank",rel:"noopener noreferrer"}},[e._v("测试密钥"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://stripe.com/docs/payments/accept-a-payment-synchronously?platform=ios",target:"_blank",rel:"noopener noreferrer"}},[e._v("Finalize card payments on the server Legacy"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://stripe.com/docs/payments/accept-a-payment?platform=web",target:"_blank",rel:"noopener noreferrer"}},[e._v("收款"),r("OutboundLink")],1)]),e._v(" "),r("p",[r("a",{attrs:{href:"https://stripe.com/docs/apple-pay",target:"_blank",rel:"noopener noreferrer"}},[e._v("添加收款方式 - Apple Pay"),r("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=s.exports}}]);