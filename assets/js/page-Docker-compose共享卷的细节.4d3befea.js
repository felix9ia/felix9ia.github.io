(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{580:function(s,n,e){"use strict";e.r(n);var a=e(1),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"docker-compose-共享卷的细节"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose-共享卷的细节"}},[s._v("#")]),s._v(" Docker-compose 共享卷的细节")]),s._v(" "),e("p",[s._v("我们拿前端的镜像编排来举例：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: '3.5'\n\nvolumes:\n  dist:\nservices:\n  die-web_build:\n    image: \"${REPO_HOST}/die_web:latest\"\n    volumes:\n      - dist:/usr/src/app\n    build:\n      context: .\n      dockerfile: ./Dockerfile\n\n\n  die-web_web:\n    image: nginx\n    ports:\n      - 58081:58081\n    container_name: 'die_nginx_web'\n    restart: unless-stopped\n    volumes:\n      - dist:/usr/share/nginx/html\n      - /etc/nginx/docker_config:/etc/nginx/conf.d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br")])]),e("p",[s._v("当你有一个命名卷 "),e("code",[s._v("dist")]),s._v(" 的时候，你会产生的疑惑是：")]),s._v(" "),e("p",[s._v("服务 "),e("code",[s._v("die-web_build")]),s._v(" 的 "),e("code",[s._v("/usr/src/app")]),s._v(" 下面会有打包出来的一些文件们 A:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("├── index.html\n├── umi.css\n└── umi.js\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("而服务 "),e("code",[s._v("die-web_web")]),s._v("的 "),e("code",[s._v("/usr/share/nginx/html")]),s._v(" 下面因为是 "),e("code",[s._v("Nginx")]),s._v("，所以会有一些默认的文件们 B：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("├── index.html\n└── 50x.html\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("那此时，你就会有疑问，共享卷是会把这些文件 "),e("code",[s._v("merge")]),s._v(" 到一起呢，还是某一个覆盖某一个呢？")]),s._v(" "),e("p",[s._v("答案都不是。")]),s._v(" "),e("p",[s._v("在参考 "),e("a",{attrs:{href:"https://stackoverflow.com/questions/58165759/docker-stack-deploy-with-compose-file-results-in-invalid-mount-config-for-type",target:"_blank",rel:"noopener noreferrer"}},[s._v('Docker stack deploy with compose-file results in invalid mount config for type "bind": bind source path does not exist:'),e("OutboundLink")],1),s._v("后，经过测试，正确的答案是：第一个挂载该命名卷的容器的文件，会被映射到命名卷当中，当前的例子，自然是 A 们入驻共享卷，而 B 挂载的目录则会出现 A 们。")]),s._v(" "),e("p",[s._v("那么如何控制共享卷下到底由谁先入驻？只需要在不想被拷贝的"),e("code",[s._v("service")]),s._v(" 上加上"),e("code",[s._v("nocopy: true")]),s._v("。")]),s._v(" "),e("p",[s._v("现在虽然依然是 A 们入驻，但已经不仅仅是因为它是第一个挂载，而是因为命名卷"),e("code",[s._v("dist")]),s._v("只有这一个可以挂载的点。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("version: '3.5'\n\nvolumes:\n  dist:\nservices:\n  die-web_build:\n    image: \"${REPO_HOST}/die_web:latest\"\n    volumes:\n      - source: dist\n        type: volume\n        target: /usr/src/app\n    build:\n      context: .\n      dockerfile: ./Dockerfile\n\n\n  die-web_web:\n    image: nginx\n    ports:\n      - 58081:58081\n    container_name: 'die_nginx_web'\n    restart: unless-stopped\n    volumes:\n      - source: dist\n        type: volume\n        target: /usr/share/nginx/html\n        volume:\n          nocopy: true\n      - /etc/nginx/docker_config:/etc/nginx/conf.d\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);